# 计算机网络 学习笔记

## part1

此部分来源于 https://www.youtube.com/watch?v=_618At72evs
![](2023-11-03-00-45-53.png)

**DNS**
<img src="2023-11-03-00-46-26.png" style="height:300px;" />

1. 查浏览器的本地缓存
2. 查本地 host 文件
3. 电脑中配置的 DNS 服务器

##### step1: 本地

**TCP/IP**
| 层 | 添加的东西 |
| ---- | --------------------------- |
| 应用 | |
| 传输 | 源端口 / 目标端口（DNS 默认为 53） |
| 网络 | 源 ip / 目标 ip | |
| 链路 | 源 MAC 地址 / 目标 MAC 地址 & 校验数据|
| 物理 | |

网络层看目标 ip 地址不在自己的网段范围内，找不到 ip 地址之后，就回去找网关（一般为路由器）
链路层提供 ARP 协议获得网关的 MAC 地址（一般为路由器 LAN 口）

##### step2: 交换机

交换机是个两层设备。它知道数据最好从哪个端口发出去。（加强版集线器）
| 层 | 操作 |
| ---- | ----------------------------------------- |
| 链路 | 查看目标 MAC 地址，把数据转发到对应的端口 |
| 物理 | |

##### step3: 路由器

| 层   | 操作                                                                      |
| ---- | ------------------------------------------------------------------------- |
| 网络 | 替换源 ip 地址和源端口号为 WAN 口 ip 地址和端口，记录在 **NAT** 映射表中  |
| 链路 | 替换源 MAC 地址和目标 MAC 地址为 WAN 口 MAC 地址和下一跳路由器的 MAC 地址 |
| 物理 |                                                                           |

网络层看目标 ip 地址，发现自己附近找不到它，于是将数据包转发到公网其他路由器（下一跳路由器）。

##### step4: DNS 服务器

##### GFW(great firewall)

- DNS 污染（劫持）
  防火墙篡改 DNS 服务器返回的 ip 地址。发生在数据从国际互联网进入国内互联网的时候。
  早期防火墙的 DNS 污染可以通过 hosts 文件来绕过。
- TCP 重置攻击
  用户发送的数据包中的目标 ip 地址或是域名被 GFW 检测到，发现其在黑名单内。将数据包直接干掉或是伪装成目标服务器返回假数据。发生在数据从国内互联网进入国际互联网的时候。
- GFW 能看到数据内容是它进行精确阻断的原因。因此传统 VPN 会对数据加密。但是它加密后的特征非常明显。防火墙虽然看不到内容，但会知道进行了 VPN 连接。

##### ShadowSocks 协议（既加密又特征不明显）

&emsp;&emsp;当浏览器发送请求的时候，会使用代理端口发送请求。请求通过防火墙来到 ShadowSocks 代理服务器。代理服务器再与目标地址通信，并将结果返回给用户。返回结果通过防火墙回到用户的 ShadowSocks 客户端，最后发回给浏览器。
&emsp;&emsp;**重放攻击**：对付 ShadowSocks 服务器，防火墙会发起**主动探测**。来看该服务器是否运行了 ShadowSocks 的服务。它会使用用户发送的数据再给 SS 服务器发一遍。简单的 SS 会被重放攻击探测到。可以引入 plugin 来解决。
&emsp;&emsp;**http plugin** 主要起到流量伪装的作用。它往 SS 请求的字节流前面加上假的 http 请求头，伪装成正常的 http 流量，让防火墙不对其进行重放攻击。出了防火墙后剪掉假的 http 头，再发往 SS 服务器。
![](2023-11-03-23-44-53.png)
&emsp;&emsp;**trojan** 基于 https 的流量伪装。
![](2023-11-04-00-27-35.png)

##### ARP Address Resolution Protocol

IP Address -> MAC Address

- MAC 是设备的物理地址，它独一无二。在局域网间通信的时候，需要使用 MAC 地址。
- 在局域网间通信的时候，它知道目标的 ip 地址，需要知道目标的 MAC 地址。如果本地的 ARP 缓存中没有该信息。ARP 就会向局域网中发送一个 ARP 请求**广播**，询问某个 IP 地址对应的 MAC 地址。如果目标计算机在同一局域网中，并且处于活动状态，则会把自己的 MAC 地址发回。

##### NAT Network Address Translation

私有 IP 地址 <---> 公共 IP 地址
&emsp;&emsp;NAT 用于在不同网络之间转换 IP 地址。它解决了 IPv4 地址短缺的问题，并提供了网络安全性。通过 NAT，多个主机可以共享单个公共 IP 地址，实现网络通信和连接。
